<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sqlite_dir (tjr_impfs.Tjr_impfs.Sqlite_dir)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tjr_impfs</a> &#x00BB; <a href="../index.html">Tjr_impfs</a> &#x00BB; Sqlite_dir</nav><header class="odoc-preamble"><h1>Module <code><span>Tjr_impfs.Sqlite_dir</span></code></h1></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../../V3_sqlite/Sqlite_dir/index.html">V3_sqlite.Sqlite_dir</a> <span class="keyword">end</span></span></code></summary><div class="odoc-spec"><div class="spec value" id="val-assert_ok" class="anchored"><a href="#val-assert_ok" class="anchor"></a><code><span><span class="keyword">val</span> assert_ok : <span><span class="xref-unresolved">Sqlite3</span>.Rc.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Times" class="anchored"><a href="#module-Times" class="anchor"></a><code><span><span class="keyword">module</span> </span><span>Times</span><span> = <span class="xref-unresolved">Tjr_fs_shared</span>.Times</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-times" class="anchored"><a href="#type-times" class="anchor"></a><code><span><span class="keyword">type</span> times</span><span> = <span class="xref-unresolved">Times</span>.times</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-List" class="anchored"><a href="#module-List" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="List/index.html">List</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Ls" class="anchored"><a href="#module-Ls" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Ls/index.html">Ls</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Op" class="anchored"><a href="#module-Op" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Op/index.html">Op</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-dir_ops" class="anchored"><a href="#type-dir_ops" class="anchor"></a><code><span><span class="keyword">type</span> <span>('k, 'v, 't, 'did) dir_ops</span></span><span> = </span><span>{</span></code><table><tr id="type-dir_ops.get_meta" class="anchored"><td class="def record field"><a href="#type-dir_ops.get_meta" class="anchor"></a><code><span>get_meta : <span>did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'did</span> * <a href="#type-times">times</a>, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.find" class="anchored"><td class="def record field"><a href="#type-dir_ops.find" class="anchor"></a><code><span>find : <span>did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'v</span> option</span>, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.exec" class="anchored"><td class="def record field"><a href="#type-dir_ops.exec" class="anchor"></a><code><span>exec : <span><span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'did</span>)</span> <a href="Op/index.html#type-op">Op.op</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.opendir" class="anchored"><td class="def record field"><a href="#type-dir_ops.opendir" class="anchor"></a><code><span>opendir : <span>did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'t</span>)</span> <a href="Ls/index.html#type-ops">Ls.ops</a></span>, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.max_did" class="anchored"><td class="def record field"><a href="#type-dir_ops.max_did" class="anchor"></a><code><span>max_did : <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'did</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>NOTE this is blocking, but is intended to be used once at startup, so potentially only results in slightly slower startup than would be possible if this was in the monad</p><span class="comment-delim">*)</span></td></tr><tr id="type-dir_ops.pre_create" class="anchored"><td class="def record field"><a href="#type-dir_ops.pre_create" class="anchor"></a><code><span>pre_create : <span>note_does_not_touch_parent:unit <span class="arrow">&#45;&gt;</span></span> <span>new_did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span>parent:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span>
<span>times:<a href="#type-times">times</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>pre-create does not touch the parent directory - that needs to be done with a separate insert</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-db" class="anchored"><a href="#type-db" class="anchor"></a><code><span><span class="keyword">type</span> db</span><span> = <span class="xref-unresolved">Sqlite3</span>.db</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-create_tables_stmt" class="anchored"><a href="#val-create_tables_stmt" class="anchor"></a><code><span><span class="keyword">val</span> create_tables_stmt : string</span></code></div><div class="spec-doc"><p>SQL commands to create a db; dir_entries and dir_meta; NOTE name is 256 length</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_tables" class="anchored"><a href="#val-create_tables" class="anchor"></a><code><span><span class="keyword">val</span> create_tables : <span><span class="xref-unresolved">Sqlite3</span>.db <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-add_root_directory_stmt" class="anchored"><a href="#val-add_root_directory_stmt" class="anchor"></a><code><span><span class="keyword">val</span> add_root_directory_stmt : string</span></code></div><div class="spec-doc"><p>Add root directory to db</p></div></div><div class="odoc-spec"><div class="spec value" id="val-add_root_directory" class="anchored"><a href="#val-add_root_directory" class="anchor"></a><code><span><span class="keyword">val</span> add_root_directory : <span><span class="xref-unresolved">Sqlite3</span>.db <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-readdir_limit" class="anchored"><a href="#val-readdir_limit" class="anchor"></a><code><span><span class="keyword">val</span> readdir_limit : int</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Make" class="anchored"><a href="#module-Make" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Make/index.html">Make</a></span><span> (<a href="Make/argument-1-S/index.html">S</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Test" class="anchored"><a href="#module-Test" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Test/index.html">Test</a></span><span> () : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></details></div></div></body></html>