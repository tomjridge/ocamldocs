<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>V2_generic (tjr_impfs.Tjr_impfs.V2_generic)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tjr_impfs</a> &#x00BB; <a href="../index.html">Tjr_impfs</a> &#x00BB; V2_generic</nav><h1>Module <code>Tjr_impfs.V2_generic</code></h1></header><aside><p>V2 generic development based on V1 generic; this layer deals with path resolution, times and a few other things; assumes create_dir and create_file.</p></aside><aside><p>$(INDEX(&quot;time,times,timestamps&quot;))</p><p>Short note on times:</p><p>POSIX has an informal spec. SibylFS has a formal spec of timestamps, but here I want a very short description of atime, mtime and ctime, suitable for a rough implementation of times.</p><p>Sources:</p><ul><li>https://www.howtogeek.com/517098/linux-file-timestamps-explained-atime-mtime-and-ctime/</li><li>https://www.unixtutorial.org/atime-ctime-mtime-in-unix-filesystems/</li></ul><p>atime: last access time (read? or read/write? what is the meaning of &quot;access&quot;? probably &quot;read of file data&quot;) for file or directory; often disabled (since updating causes a disk write)</p><p>ctime: last (metadata) change (ownership, access perms, ...); also updated if contents change; probably doesn't affect us since we don't currently have ownership or access perms</p><p>mtime: last change to file contents; does not change when eg ownership/perms change</p><p>Since &quot;file size&quot; is typically counted as metadata (!), it is clear that parts of metadata are considered differently from others (ctime identifies some subset of file metadata... ctime doesn't change when file size changes I expect).</p><p>Personally, I would consider file data (and the related file size) as independent of anything else about the file (ownership, permissions, timestamp). Then it makes sense to talk about when the file data (not the metadata!) was last read, and when it was last written. So, for us, let's define atime as &quot;last read time&quot;, ignore ctime (identify with mtime), and mtime as the time the data was last modified (including truncate of course).</p><p>Since atime is usually ignored/disabled anyway, we end up with just mtime. For files, this likely changes on pwrite and truncate (set_times confusingly doesn't itself automatically update mtime, since the purpose of set_times is precisely to allow updating the mtime to some specific value).</p><p>For directories, we should update mtime on insert and delete. The slight issue is that we may want a cross-directory rename to appear to happen at a single time. For a cross directory rename, we should call &quot;set_times&quot; on both the source and destination directory, with the same timestamp, AFTER the rename has inserted and deleted.</p><p>Should files/directories be responsible for updating their own timestamps? As above, this makes sense, except in cases like rename where we may want the src and target dirs to have identical mtimes. (And even in this case, does anyone program applications to work only if this behaviour is implemented by the filesystem?). So we DON'T explicitly update times in this generic code (unless eg for rename case)</p></aside><dl><dt class="spec type" id="type-exn_"><a href="#type-exn_" class="anchor"></a><code><span class="keyword">type</span> exn_</code><code> = Tjr_minifs.Minifs_intf.exn_</code></dt><dt class="spec type" id="type-stat_times"><a href="#type-stat_times" class="anchor"></a><code><span class="keyword">type</span> stat_times</code><code> = Tjr_minifs.Minifs_intf.times</code></dt><dt class="spec type" id="type-stat_record"><a href="#type-stat_record" class="anchor"></a><code><span class="keyword">type</span> stat_record</code><code> = Tjr_minifs.Minifs_intf.stat_record</code></dt></dl><dl><dt class="spec module-type" id="module-type-S0"><a href="#module-type-S0" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S0/index.html">S0</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Very basic types</p></dd></dl><dl><dt class="spec module" id="module-S1"><a href="#module-S1" class="anchor"></a><code><span class="keyword">module</span> <a href="S1/index.html">S1</a> : <span class="keyword">functor</span> (<a href="S1/argument-1-S0/index.html">S0</a> : <a href="index.html#module-type-S0">S0</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Types created from basic types</p></dd></dl><dl><dt class="spec module" id="module-S2"><a href="#module-S2" class="anchor"></a><code><span class="keyword">module</span> <a href="S2/index.html">S2</a> : <span class="keyword">functor</span> (<a href="S2/argument-1-S0/index.html">S0</a> : <a href="index.html#module-type-S0">S0</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>The values we expect to be present</p></dd></dl><dl><dt class="spec module-type" id="module-type-T"><a href="#module-type-T" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-T/index.html">T</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>The resulting filesystem (fd is a file identifier, dh is a directory handle supporting leaf_stream operations)</p></dd></dl><div class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-S0/index.html">S0</a> : <a href="index.html#module-type-S0">S0</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-X"><a href="#module-X" class="anchor"></a><code><span class="keyword">module</span> X = <a href="index.html#module-Make">Make</a></code></div></div></body></html>