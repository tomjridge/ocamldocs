<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>V1_resource_manager_UNUSED (tjr_impfs.Tjr_impfs.V1_resource_manager_UNUSED)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../index.html">tjr_impfs</a> &#x00BB; <a href="../index.html">Tjr_impfs</a> &#x00BB; V1_resource_manager_UNUSED</nav><header class="odoc-preamble"><h1>Module <code><span>Tjr_impfs.V1_resource_manager_UNUSED</span></code></h1></header><div class="odoc-content"><p>This code takes care of the various resources that need to be correctly locked in a concurrent setting. Superseded by Ownership_map?</p><div class="odoc-spec"><div class="spec type" id="type-tid" class="anchored"><a href="#type-tid" class="anchor"></a><code><span><span class="keyword">type</span> tid</span><span> = </span><span>{</span></code><table><tr id="type-tid.tid" class="anchored"><td class="def record field"><a href="#type-tid.tid" class="anchor"></a><code><span>tid : int;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-compare_tid" class="anchored"><a href="#val-compare_tid" class="anchor"></a><code><span><span class="keyword">val</span> compare_tid : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-new_tid" class="anchored"><a href="#val-new_tid" class="anchor"></a><code><span><span class="keyword">val</span> new_tid : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-tid">tid</a>, <span class="xref-unresolved">Tjr_monad</span>.With_lwt.lwt)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-live_thread_ops" class="anchored"><a href="#type-live_thread_ops" class="anchor"></a><code><span><span class="keyword">type</span> live_thread_ops</span><span> = </span><span>{</span></code><table><tr id="type-live_thread_ops.add" class="anchored"><td class="def record field"><a href="#type-live_thread_ops.add" class="anchor"></a><code><span>add : <span><a href="#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td></tr><tr id="type-live_thread_ops.remove" class="anchored"><td class="def record field"><a href="#type-live_thread_ops.remove" class="anchor"></a><code><span>remove : <span><a href="#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td></tr><tr id="type-live_thread_ops.size" class="anchored"><td class="def record field"><a href="#type-live_thread_ops.size" class="anchor"></a><code><span>size : <span>unit <span class="arrow">&#45;&gt;</span></span> int;</span></code></td></tr><tr id="type-live_thread_ops.size_below_bound" class="anchored"><td class="def record field"><a href="#type-live_thread_ops.size_below_bound" class="anchor"></a><code><span>size_below_bound : <span>unit <span class="arrow">&#45;&gt;</span></span> bool;</span></code></td></tr></table><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-thread_max" class="anchored"><a href="#val-thread_max" class="anchor"></a><code><span><span class="keyword">val</span> thread_max : int</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-live_threads" class="anchored"><a href="#val-live_threads" class="anchor"></a><code><span><span class="keyword">val</span> live_threads : <a href="#type-live_thread_ops">live_thread_ops</a></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-oid" class="anchored"><a href="#type-oid" class="anchor"></a><code><span><span class="keyword">type</span> oid</span><span> = </span></code><table><tr id="type-oid.Gom_id" class="anchored"><td class="def variant constructor"><a href="#type-oid.Gom_id" class="anchor"></a><code><span>| </span><span><span class="constructor">Gom_id</span></span></code></td></tr><tr id="type-oid.Fid" class="anchored"><td class="def variant constructor"><a href="#type-oid.Fid" class="anchor"></a><code><span>| </span><span><span class="constructor">Fid</span> <span class="keyword">of</span> int</span></code></td></tr><tr id="type-oid.Did" class="anchored"><td class="def variant constructor"><a href="#type-oid.Did" class="anchor"></a><code><span>| </span><span><span class="constructor">Did</span> <span class="keyword">of</span> int</span></code></td></tr></table></div></div><div class="odoc-spec"><div class="spec value" id="val-compare_oid" class="anchored"><a href="#val-compare_oid" class="anchor"></a><code><span><span class="keyword">val</span> compare_oid : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Map_oid" class="anchored"><a href="#module-Map_oid" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Map_oid/index.html">Map_oid</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-resource_ops" class="anchored"><a href="#type-resource_ops" class="anchor"></a><code><span><span class="keyword">type</span> resource_ops</span><span> = </span><span>{</span></code><table><tr id="type-resource_ops.owns_nothing" class="anchored"><td class="def record field"><a href="#type-resource_ops.owns_nothing" class="anchor"></a><code><span>owns_nothing : <span><a href="#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> bool;</span></code></td></tr><tr id="type-resource_ops.acquire" class="anchored"><td class="def record field"><a href="#type-resource_ops.acquire" class="anchor"></a><code><span>acquire : <span>tid:<a href="#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <span>oid:<a href="#type-oid">oid</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="xref-unresolved">Tjr_fs_shared</span>.Shared_ctxt.t)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-resource_ops.acquire_all" class="anchored"><td class="def record field"><a href="#type-resource_ops.acquire_all" class="anchor"></a><code><span>acquire_all : <span>tid:<a href="#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <span>oids:<span><a href="#type-oid">oid</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="xref-unresolved">Tjr_fs_shared</span>.Shared_ctxt.t)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-resource_ops.release" class="anchored"><td class="def record field"><a href="#type-resource_ops.release" class="anchor"></a><code><span>release : <span>tid:<a href="#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <span>oid:<a href="#type-oid">oid</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="xref-unresolved">Tjr_fs_shared</span>.Shared_ctxt.t)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-resource_ops.release_all" class="anchored"><td class="def record field"><a href="#type-resource_ops.release_all" class="anchor"></a><code><span>release_all : <span><a href="#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="xref-unresolved">Tjr_fs_shared</span>.Shared_ctxt.t)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>acquire and acquire_all require that the thread does not own any resources; this is so that we can guarantee that the resources are obtained in order so we avoid deadlock</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Per_object_data" class="anchored"><a href="#module-Per_object_data" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Per_object_data/index.html">Per_object_data</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Ownership_map" class="anchored"><a href="#module-Ownership_map" class="anchor"></a><code><span><span class="keyword">module</span> </span><span>Ownership_map</span><span> = <a href="../Ownership_map_UNUSED/index.html">Ownership_map_UNUSED</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-resource_ops" class="anchored"><a href="#val-resource_ops" class="anchor"></a><code><span><span class="keyword">val</span> resource_ops : <a href="#type-resource_ops">resource_ops</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-A" class="anchored"><a href="#module-A" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="A/index.html">A</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-B" class="anchored"><a href="#module-B" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="B/index.html">B</a></span><span> (<a href="B/argument-1-S/index.html">S</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>