<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dir_ops (tjr_impfs.V3_sqlite.Sqlite_dir.Dir_ops)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">tjr_impfs</a> &#x00BB; <a href="../../index.html">V3_sqlite</a> &#x00BB; <a href="../index.html">Sqlite_dir</a> &#x00BB; Dir_ops</nav><header class="odoc-preamble"><h1>Module <code><span>Sqlite_dir.Dir_ops</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-dir_ops" class="anchored"><a href="#type-dir_ops" class="anchor"></a><code><span><span class="keyword">type</span> <span>('k, 'v, 't, 'did) dir_ops</span></span><span> = </span><span>{</span></code><table><tr id="type-dir_ops.get_meta" class="anchored"><td class="def record field"><a href="#type-dir_ops.get_meta" class="anchor"></a><code><span>get_meta : <span>did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'did</span> * <a href="../index.html#type-times">times</a>, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.find" class="anchored"><td class="def record field"><a href="#type-dir_ops.find" class="anchor"></a><code><span>find : <span>did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'k</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'v</span> option</span>, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.exec" class="anchored"><td class="def record field"><a href="#type-dir_ops.exec" class="anchor"></a><code><span>exec : <span><span><span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'did</span>)</span> <a href="../Op/index.html#type-op">Op.op</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.opendir" class="anchored"><td class="def record field"><a href="#type-dir_ops.opendir" class="anchor"></a><code><span>opendir : <span>did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'t</span>)</span> <a href="../Ls/index.html#type-ops">Ls.ops</a></span>, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr><tr id="type-dir_ops.max_did" class="anchored"><td class="def record field"><a href="#type-dir_ops.max_did" class="anchor"></a><code><span>max_did : <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'did</span>;</span></code></td></tr><tr id="type-dir_ops.pre_create" class="anchored"><td class="def record field"><a href="#type-dir_ops.pre_create" class="anchor"></a><code><span>pre_create : <span>note_does_not_touch_parent:unit <span class="arrow">&#45;&gt;</span></span> <span>new_did:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span> <span>parent:<span class="type-var">'did</span> <span class="arrow">&#45;&gt;</span></span>
<span>times:<a href="../index.html#type-times">times</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'t</span>)</span> <span class="xref-unresolved">Tjr_monad</span>.m</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>NOTE <code>'k</code> is typically &quot;name&quot; of directory entry (a short string); <code>'v</code> is the directory entry itself (a pointer to a file/dir/symlink); we don't assume much about a <code>dir_entry</code> apart from that we can convert it to/from a string/blob.</p><p>Fields are:</p><ul><li><code>get_meta</code> - parent and time info</li><li><code>find</code> a particular entry</li><li><code>exec</code> a list of operations (insert, delete, set parent, set times)</li><li><code>opendir</code> - return a list of entries</li><li><code>max_did</code> - used once on startup, so we can allocate fresh <code>did</code>s; NOTE this is blocking, but is intended to be used once at startup, so potentially only results in slightly slower startup than would be possible if this was in the monad</li><li><code>pre_create</code> which creates a new directory, with a given parent, but does not touch the parent (that has to be done separately)</li></ul></div></div></div></body></html>