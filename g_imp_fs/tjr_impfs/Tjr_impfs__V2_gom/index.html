<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tjr_impfs__V2_gom (tjr_impfs.Tjr_impfs__V2_gom)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">tjr_impfs</a> &#x00BB; Tjr_impfs__V2_gom</nav><h1>Module <code>Tjr_impfs__V2_gom</code></h1><p>The &quot;global object map&quot; GOM</p><p>This is just an instance of Tjr_btree, mapping object id (which we identify with dir_entry) to blk_id</p><p>NOTE this is responsible for handling its own synchronization</p><p>FIXME this should use allocation via a usedlist</p></header><dl><dt class="spec value" id="val-dont_log"><a href="#val-dont_log" class="anchor"></a><code><span class="keyword">val</span> dont_log : bool</code></dt></dl><div class="spec module" id="module-Usedlist"><a href="#module-Usedlist" class="anchor"></a><code><span class="keyword">module</span> Usedlist = <a href="../Tjr_impfs/Usedlist_impl/index.html#module-Usedlist">Tjr_impfs.Usedlist_impl.Usedlist</a></code></div><div class="spec module" id="module-Gom_origin_block"><a href="#module-Gom_origin_block" class="anchor"></a><code><span class="keyword">module</span> <a href="Gom_origin_block/index.html">Gom_origin_block</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Gom_ops"><a href="#module-Gom_ops" class="anchor"></a><code><span class="keyword">module</span> <a href="Gom_ops/index.html">Gom_ops</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-gom_factory"><a href="#type-gom_factory" class="anchor"></a><code><span class="keyword">type</span> <span>('blk_id, 'blk, 't, 'de, 'gom_ops) gom_factory</span></code><code> = &lt; note_type_abbrev : <span class="type-var">'gom_ops</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'de</span>, <span class="type-var">'blk_id</span>, <span class="type-var">'blk_id</span>, <span class="type-var">'t</span>)</span> <a href="$Open__46_925/index.html#type-$gom_ops">$gom_ops</a></span> <span>&#45;&gt;</span> unit; read_origin : <span>blk_dev_ops:<span><span>(<span class="type-var">'blk_id</span>, <span class="type-var">'blk</span>, <span class="type-var">'t</span>)</span> Tjr_fs_shared.blk_dev_ops</span></span> <span>&#45;&gt;</span> <span>blk_id:<span class="type-var">'blk_id</span></span> <span>&#45;&gt;</span> <span><span>(<span><span class="type-var">'blk_id</span> <a href="$Open__30_568/index.html#type-$origin">$origin</a></span>, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>; write_origin : <span>blk_dev_ops:<span><span>(<span class="type-var">'blk_id</span>, <span class="type-var">'blk</span>, <span class="type-var">'t</span>)</span> Tjr_fs_shared.blk_dev_ops</span></span> <span>&#45;&gt;</span> <span>blk_id:<span class="type-var">'blk_id</span></span> <span>&#45;&gt;</span> <span>origin:<span><span class="type-var">'blk_id</span> <a href="$Open__30_568/index.html#type-$origin">$origin</a></span></span> <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>; with_ : <span>blk_dev_ops:<span><span>(<span class="type-var">'blk_id</span>, <span class="type-var">'blk</span>, <span class="type-var">'t</span>)</span> Tjr_fs_shared.blk_dev_ops</span></span> <span>&#45;&gt;</span> <span>barrier:<span>(unit <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>)</span></span> <span>&#45;&gt;</span> <span>sync:<span>(unit <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>)</span></span> <span>&#45;&gt;</span> <span>freelist_ops:<span><span>(<span class="type-var">'blk_id</span>, <span class="type-var">'blk_id</span>, <span class="type-var">'t</span>)</span> <a href="../Tjr_impfs/Freelist_intf/index.html#type-freelist_ops">Tjr_impfs.Freelist_intf.freelist_ops</a></span></span> <span>&#45;&gt;</span> &lt; usedlist_ops : <span><span class="type-var">'blk_id</span> <a href="../Tjr_impfs__Usedlist_impl/Usedlist/index.html#type-origin">Usedlist.origin</a></span> <span>&#45;&gt;</span> <span><span>(<span><span>(<span class="type-var">'blk_id</span>, <span class="type-var">'t</span>)</span> <a href="../Tjr_impfs__Usedlist_impl/Usedlist/index.html#type-ops">Usedlist.ops</a></span>, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>; alloc_via_usedlist : <span><span>(<span class="type-var">'blk_id</span>, <span class="type-var">'t</span>)</span> <a href="../Tjr_impfs__Usedlist_impl/Usedlist/index.html#type-ops">Usedlist.ops</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'blk_id</span>, <span class="type-var">'t</span>)</span> Tjr_fs_shared.blk_allocator_ops</span>; create : unit <span>&#45;&gt;</span> <span><span>(&lt; gom_ops : <span class="type-var">'gom_ops</span>; origin : <span class="type-var">'blk_id</span>; &gt;, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>; init_from_origin : <span class="type-var">'blk_id</span> <span>&#45;&gt;</span> <span><span class="type-var">'blk_id</span> <a href="$Open__30_568/index.html#type-$origin">$origin</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'gom_ops</span>, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>; init_from_disk : <span class="type-var">'blk_id</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'gom_ops</span>, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>; &gt;; &gt;</code></dt></dl><dl><dt class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-S/index.html">S</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Functor, reasonably abstract, but assumes blk=ba_buf, t=lwt</p></dd></dl><div class="spec module" id="module-Dir_entry"><a href="#module-Dir_entry" class="anchor"></a><code><span class="keyword">module</span> <a href="Dir_entry/index.html">Dir_entry</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Pvt"><a href="#module-Pvt" class="anchor"></a><code><span class="keyword">module</span> <a href="Pvt/index.html">Pvt</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-gom_example"><a href="#val-gom_example" class="anchor"></a><code><span class="keyword">val</span> gom_example : <span><span>(Tjr_fs_shared.Shared_ctxt.blk_id, Tjr_fs_shared.Shared_ctxt.buf, Tjr_fs_shared.Shared_ctxt.t, <a href="Dir_entry/index.html#type-t">Dir_entry.t</a>, <a href="Pvt/S/index.html#type-gom_ops">Pvt.S.gom_ops</a>)</span> <a href="index.html#type-gom_factory">gom_factory</a></span></code></dt></dl></div></body></html>