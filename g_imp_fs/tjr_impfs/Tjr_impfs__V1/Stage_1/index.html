<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Stage_1 (tjr_impfs.Tjr_impfs__V1.Stage_1)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">tjr_impfs</a> &#x00BB; <a href="../index.html">Tjr_impfs__V1</a> &#x00BB; Stage_1</nav><h1>Module <code>Tjr_impfs__V1.Stage_1</code></h1><h3 id="stage-1-functor"><a href="#stage-1-functor" class="anchor"></a>Stage 1 functor</h3><nav class="toc"><ul><li><a href="#definitions-after-the-gom-root-is-known">Definitions after the GOM root is known</a></li><li><a href="#dirs-collection">Dirs collection</a></li><li><a href="#file-struct">File struct</a></li><li><a href="#files-collection">Files collection</a></li><li><a href="#symlinks">Symlinks</a></li><li><a href="#instantiate-filesystem">Instantiate filesystem</a></li></ul></nav></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-R1/index.html">R1</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></li></ul><h3 class="heading">Signature</h3><dl><dt class="spec value" id="val-min_free_id_ref"><a href="#val-min_free_id_ref" class="anchor"></a><code><span class="keyword">val</span> min_free_id_ref : <span>int Stdlib.ref</span></code></dt><dd><p>We use mutually exclusive subsets of int for identifiers; NOTE 0 is reserved for the root directory</p></dd></dl><dl><dt class="spec value" id="val-new_id"><a href="#val-new_id" class="anchor"></a><code><span class="keyword">val</span> new_id : unit <span>&#45;&gt;</span> <span><span>(int, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-new_did"><a href="#val-new_did" class="anchor"></a><code><span class="keyword">val</span> new_did : unit <span>&#45;&gt;</span> <span><span>(<a href="../S0/index.html#type-did">S0.did</a>, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-new_fid"><a href="#val-new_fid" class="anchor"></a><code><span class="keyword">val</span> new_fid : unit <span>&#45;&gt;</span> <span><span>(<a href="../S0/index.html#type-fid">S0.fid</a>, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-new_sid"><a href="#val-new_sid" class="anchor"></a><code><span class="keyword">val</span> new_sid : unit <span>&#45;&gt;</span> <span><span>(<a href="../S0/index.html#type-sid">S0.sid</a>, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-id_to_int"><a href="#val-id_to_int" class="anchor"></a><code><span class="keyword">val</span> id_to_int : <a href="../Make/S1/index.html#type-dir_entry">S1.dir_entry</a> <span>&#45;&gt;</span> int</code></dt></dl><section><header><h3 id="definitions-after-the-gom-root-is-known"><a href="#definitions-after-the-gom-root-is-known" class="anchor"></a>Definitions after the GOM root is known</h3></header><dl><dt class="spec value" id="val-gom_btree"><a href="#val-gom_btree" class="anchor"></a><code><span class="keyword">val</span> gom_btree : &lt; get_btree_root : unit <span>&#45;&gt;</span> <span><span>(<a href="../Gom_btree/M1/index.html#type-r">Gom_btree.M1.r</a>, <a href="../Gom_btree/M1/index.html#type-t">Gom_btree.M1.t</a>)</span> Tjr_monad.m</span>; map_ops_with_ls : <span><span>(<a href="../Gom_btree/M1/index.html#type-k">Gom_btree.M1.k</a>, <a href="../Gom_btree/M1/index.html#type-v">Gom_btree.M1.v</a>, <a href="../Gom_btree/M1/index.html#type-r">Gom_btree.M1.r</a>, <a href="../Gom_btree/M1/index.html#type-leaf_stream">Gom_btree.M1.leaf_stream</a>, <a href="../Gom_btree/M1/index.html#type-t">Gom_btree.M1.t</a>)</span> Tjr_btree__.Btree_intf.map_ops_with_ls</span>; with_state : <span><span>(<a href="../Gom_btree/M1/index.html#type-r">Gom_btree.M1.r</a>, <a href="../Gom_btree/M1/index.html#type-t">Gom_btree.M1.t</a>)</span> Tjr_monad.with_state</span>; &gt;</code></dt><dt class="spec value" id="val-gom_find_opt"><a href="#val-gom_find_opt" class="anchor"></a><code><span class="keyword">val</span> gom_find_opt : <span>k:<a href="../Gom_btree/M1/index.html#type-k">Gom_btree.M1.k</a></span> <span>&#45;&gt;</span> <span><span>(<span><a href="../Gom_btree/M1/index.html#type-v">Gom_btree.M1.v</a> option</span>, <a href="../Gom_btree/M1/index.html#type-t">Gom_btree.M1.t</a>)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-gom_find"><a href="#val-gom_find" class="anchor"></a><code><span class="keyword">val</span> gom_find : <a href="../Gom_btree/M1/index.html#type-k">Gom_btree.M1.k</a> <span>&#45;&gt;</span> <span><span>(<a href="../Gom_btree/M1/index.html#type-v">Gom_btree.M1.v</a>, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-gom_insert"><a href="#val-gom_insert" class="anchor"></a><code><span class="keyword">val</span> gom_insert : <span>k:<a href="../Gom_btree/M1/index.html#type-k">Gom_btree.M1.k</a></span> <span>&#45;&gt;</span> <span>v:<a href="../Gom_btree/M1/index.html#type-v">Gom_btree.M1.v</a></span> <span>&#45;&gt;</span> <span><span>(unit, <a href="../Gom_btree/M1/index.html#type-t">Gom_btree.M1.t</a>)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-gom_delete"><a href="#val-gom_delete" class="anchor"></a><code><span class="keyword">val</span> gom_delete : <span>k:<a href="../Gom_btree/M1/index.html#type-k">Gom_btree.M1.k</a></span> <span>&#45;&gt;</span> <span><span>(unit, <a href="../Gom_btree/M1/index.html#type-t">Gom_btree.M1.t</a>)</span> Tjr_monad.m</span></code></dt></dl><aside><p>In order to incorporate path resolution, we need to be able to lookup an entry in a directory</p></aside><div class="spec module" id="module-Make_root_blk_ops"><a href="#module-Make_root_blk_ops" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_root_blk_ops/index.html">Make_root_blk_ops</a> : <span class="keyword">functor</span> (<a href="Make_root_blk_ops/argument-1-S/index.html">S</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec module" id="module-Dir"><a href="#module-Dir" class="anchor"></a><code><span class="keyword">module</span> <a href="Dir/index.html">Dir</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd></dd></dl><dl><dt class="spec value" id="val-resolve_path"><a href="#val-resolve_path" class="anchor"></a><code><span class="keyword">val</span> resolve_path : <span>follow_last_symlink:Tjr_path_resolution.follow_last_symlink</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span>(<span><span>(<a href="../S0/index.html#type-fid">S0.fid</a>, <a href="../S0/index.html#type-did">S0.did</a>)</span> Tjr_path_resolution.resolved_path_or_err</span>, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt></dl></section><section><header><h3 id="dirs-collection"><a href="#dirs-collection" class="anchor"></a>Dirs collection</h3></header><dl><dt class="spec value" id="val-dirs"><a href="#val-dirs" class="anchor"></a><code><span class="keyword">val</span> dirs : <a href="../Make/S1/index.html#type-dirs_ops">S1.dirs_ops</a></code></dt><dd><p>The dirs ops, find and delete FIXME these need to be maintained in a pool, and only one instance per id</p></dd></dl></section><section><header><h3 id="file-struct"><a href="#file-struct" class="anchor"></a>File struct</h3></header><div class="spec module" id="module-File"><a href="#module-File" class="anchor"></a><code><span class="keyword">module</span> <a href="File/index.html">File</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="files-collection"><a href="#files-collection" class="anchor"></a>Files collection</h3></header><div class="spec module" id="module-Files"><a href="#module-Files" class="anchor"></a><code><span class="keyword">module</span> <a href="Files/index.html">Files</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-files"><a href="#val-files" class="anchor"></a><code><span class="keyword">val</span> files : <a href="../Make/S1/index.html#type-files_ops">S1.files_ops</a></code></dt><dt class="spec value" id="val-extra"><a href="#val-extra" class="anchor"></a><code><span class="keyword">val</span> extra : <a href="../Make/S1/index.html#type-extra_ops">S1.extra_ops</a></code></dt><dd><p>Extra ops</p></dd></dl><aside><p>create_dir, create_file and create_symlink</p></aside><dl><dt class="spec value" id="val-create_file"><a href="#val-create_file" class="anchor"></a><code><span class="keyword">val</span> create_file : <span>parent:<a href="../S0/index.html#type-did">S0.did</a></span> <span>&#45;&gt;</span> <span>name:Tjr_fs_shared.str_256</span> <span>&#45;&gt;</span> <span>times:<a href="../../Tjr_impfs__V1_generic/index.html#type-stat_times">Tjr_impfs__V1_generic.stat_times</a></span> <span>&#45;&gt;</span> <span><span>(unit, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-create_dir_"><a href="#val-create_dir_" class="anchor"></a><code><span class="keyword">val</span> create_dir_ : <span>is_root:bool</span> <span>&#45;&gt;</span> <span>parent:<a href="../S0/index.html#type-did">S0.did</a></span> <span>&#45;&gt;</span> <span>name:Tjr_fs_shared.Str_256.str_256</span> <span>&#45;&gt;</span> <span>times:Tjr_minifs.Minifs_intf.Times.times</span> <span>&#45;&gt;</span> <span><span>(unit, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-create_dir"><a href="#val-create_dir" class="anchor"></a><code><span class="keyword">val</span> create_dir : <span>parent:<a href="../S0/index.html#type-did">S0.did</a></span> <span>&#45;&gt;</span> <span>name:Tjr_fs_shared.Str_256.str_256</span> <span>&#45;&gt;</span> <span>times:Tjr_minifs.Minifs_intf.Times.times</span> <span>&#45;&gt;</span> <span><span>(unit, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-create_root_dir"><a href="#val-create_root_dir" class="anchor"></a><code><span class="keyword">val</span> create_root_dir : <span>times:Tjr_minifs.Minifs_intf.Times.times</span> <span>&#45;&gt;</span> <span><span>(unit, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt></dl></section><section><header><h3 id="symlinks"><a href="#symlinks" class="anchor"></a>Symlinks</h3></header><div class="spec module" id="module-Symlink"><a href="#module-Symlink" class="anchor"></a><code><span class="keyword">module</span> <a href="Symlink/index.html">Symlink</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-create_symlink"><a href="#val-create_symlink" class="anchor"></a><code><span class="keyword">val</span> create_symlink : <span>parent:<a href="../S0/index.html#type-did">S0.did</a></span> <span>&#45;&gt;</span> <span>name:Tjr_fs_shared.str_256</span> <span>&#45;&gt;</span> <span>times:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>contents:Tjr_fs_shared.Str_256.str_256</span> <span>&#45;&gt;</span> <span><span>(unit, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt><dt class="spec value" id="val-read_symlink"><a href="#val-read_symlink" class="anchor"></a><code><span class="keyword">val</span> read_symlink : <a href="../S0/index.html#type-sid">S0.sid</a> <span>&#45;&gt;</span> <span><span>(Tjr_fs_shared.Str_256.str_256, Tjr_monad.With_lwt.lwt)</span> Tjr_monad.m</span></code></dt></dl></section><section><header><h3 id="instantiate-filesystem"><a href="#instantiate-filesystem" class="anchor"></a>Instantiate filesystem</h3></header><div class="spec module" id="module-X"><a href="#module-X" class="anchor"></a><code><span class="keyword">module</span> <a href="X/index.html">X</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-The_filesystem"><a href="#module-The_filesystem" class="anchor"></a><code><span class="keyword">module</span> <a href="The_filesystem/index.html">The_filesystem</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>