<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tjr_impfs__Context (tjr_impfs.Tjr_impfs__Context)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">tjr_impfs</a> &#x00BB; Tjr_impfs__Context</nav><h1>Module <code>Tjr_impfs__Context</code></h1><p>File system calls correspond to an lwt thread execution. The context is per-thread, and keeps track of eg resources (such as locks that have been acquired).</p><nav class="toc"><ul><li><a href="#front-end-cache-entries">Front-end cache entries</a></li></ul></nav></header><dl><dt class="spec type" id="type-ctxt_ops"><a href="#type-ctxt_ops" class="anchor"></a><code><span class="keyword">type</span> <span>('res, 't) ctxt_ops</span></code><code> = </code><code>{</code><table class="record"><tr id="type-ctxt_ops.acquire" class="anchored"><td class="def field"><a href="#type-ctxt_ops.acquire" class="anchor"></a><code>acquire : <span class="type-var">'res</span> <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr><tr id="type-ctxt_ops.release" class="anchored"><td class="def field"><a href="#type-ctxt_ops.release" class="anchor"></a><code>release : <span class="type-var">'res</span> <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr><tr id="type-ctxt_ops.release_all" class="anchored"><td class="def field"><a href="#type-ctxt_ops.release_all" class="anchor"></a><code>release_all : unit <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr><tr id="type-ctxt_ops.assert_no_resources" class="anchored"><td class="def field"><a href="#type-ctxt_ops.assert_no_resources" class="anchor"></a><code>assert_no_resources : unit <span>&#45;&gt;</span> unit;</code></td></tr></table><code>}</code></dt></dl><aside><p>acquire obtains the lock on a resource, and updates the context to record this</p></aside><div class="spec module-type" id="module-type-T"><a href="#module-type-T" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-T/index.html">T</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><section><header><h3 id="front-end-cache-entries"><a href="#front-end-cache-entries" class="anchor"></a>Front-end cache entries</h3></header><aside><p>We want this to be as independent of the backend as possible. For Gom, file, directory and symlink it is fairly clear what the generic cache should be. What is not so clear is what the interface should be to the implementation-specific cache.</p></aside><dl><dt class="spec type" id="type-maybe_dirty"><a href="#type-maybe_dirty" class="anchor"></a><code><span class="keyword">type</span> <span>'a maybe_dirty</span></code><code> = <span class="type-var">'a</span> * bool</code></dt><dt class="spec type" id="type-map_cache"><a href="#type-map_cache" class="anchor"></a><code><span class="keyword">type</span> <span>('a, 'b) map_cache</span></code></dt><dt class="spec type" id="type-file_extra"><a href="#type-file_extra" class="anchor"></a><code><span class="keyword">type</span> file_extra</code><code> = </code><code>{</code><table class="record"><tr id="type-file_extra.fd" class="anchored"><td class="def field"><a href="#type-file_extra.fd" class="anchor"></a><code>fd : Unix.file_descr;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec module" id="module-Lock_layer"><a href="#module-Lock_layer" class="anchor"></a><code><span class="keyword">module</span> <a href="Lock_layer/index.html">Lock_layer</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>per-object locks</p></dd></dl><dl><dt class="spec module" id="module-Cache_1"><a href="#module-Cache_1" class="anchor"></a><code><span class="keyword">module</span> <a href="Cache_1/index.html">Cache_1</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>implementation independent cache</p></dd></dl><dl><dt class="spec module" id="module-Lower_layer"><a href="#module-Lower_layer" class="anchor"></a><code><span class="keyword">module</span> <a href="Lower_layer/index.html">Lower_layer</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>the lower object layer, no caching</p></dd></dl></section></div></body></html>