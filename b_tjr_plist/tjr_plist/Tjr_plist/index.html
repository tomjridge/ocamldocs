<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tjr_plist (tjr_plist.Tjr_plist)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">tjr_plist</a> &#x00BB; Tjr_plist</nav><h1>Module <code>Tjr_plist</code></h1><p>A persistent (on-disk) list.</p>
<img width='100%' src="https://docs.google.com/drawings/d/e/2PACX-1vT1LGM8Sm7USD8LF_CGLUVZ270PK4vk5LcBrENxjcebpRUYq4jxPpgCTzNFsIS8TOgrcsVvcbZcNJ-M/pub?w=974&amp;h=871">
<p>Look at <a href="Plist_intf/index.html"><code>Plist_intf</code></a> for the main types.</p><p>Sync behaviour: There are at least 3 choices (in addition to respecting explicit syncs):</p><ul><li>sync on every add</li></ul><ul><li>sync on moving to a new tl</li></ul><p>The current implementation syncs when moving to a new tail, not on every add. The sequence of operations is:</p><ul><li>Allocate new tail block and initialize it; sync</li><li>Update current tail block with next pointer to new tail; sync</li><li>Update in-memory state so that the new tail becomes the &quot;current&quot; tail</li></ul></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../Tjr_plist__/index.html#module-Summary">Tjr_plist__.Summary</a></code></span></summary><aside><p>Summary of main types</p></aside><aside><pre><code class="ml">  type 'blk_id pl_root_info = {
    hd  : 'blk_id;
    tl  : 'blk_id;
    blk_len : int
  }

type ('blk_id,'buf) plist = {
  hd      : 'blk_id;
  tl      : 'blk_id;
  buffer  : 'buf;
  off     : int;
  blk_len : int;
  dirty   : bool; (** may not have been written to disk *)
}

type ('a,'blk_id,'blk,'buf,'t) plist_factory = &lt;
  monad_ops          :'t monad_ops;
  buf_ops            :'buf buf_ops;
  blk_ops            : 'blk blk_ops;
  plist_marshal_info : ('a,'blk_id,'blk,'buf) plist_marshal_info;
  plist_marshal_ops  : ('a,'blk_id,'blk) plist_marshal_ops; 
  with_blk_dev_ops   :  
    blk_dev_ops : ('blk_id,'blk,'t)blk_dev_ops -&gt;
    sync : unit -&gt; (unit,'t)m
    -&gt; &lt;
      init : &lt;
        mk_empty    : 'blk_id -&gt; (('blk_id,'buf)plist,'t)m;
        from_hd     : 'blk_id -&gt; ( ('a list * 'blk_id option) list, 't) m; 
        from_endpts : 'blk_id Pl_root_info.pl_root_info -&gt; (
            &lt;
              plist      : ('blk_id,'buf)plist;
              plist_ref  : ('blk_id,'buf)plist ref;              
              with_plist : (('blk_id,'buf)plist,'t)with_state;
              plist_ops  : ('a,'buf,'blk_id,'t)plist_ops;            
            &gt;,'t)m;
      &gt;;

      with_state      : 
        (('blk_id,'buf)plist,'t)with_state -&gt; 
        ('a,'buf,'blk_id,'t)plist_ops;
    &gt;
&gt;

type ('a,'buf (* FIXME *),'blk_id,(* 'blk,*) 't) plist_ops = {
  add       : nxt:'blk_id -&gt; elt:'a -&gt; ('blk_id option,'t) m;
  add_if_room: 'a -&gt; (bool,'t)m;
  sync_tl   : unit -&gt; (unit,'t)m;
  blk_len   : unit -&gt; (int,'t)m;
  adv_hd    : unit -&gt; ( ('a,'blk_id) adv_hd or_error,'t)m; 
  (** advance hd *)

  adv_tl    : 'blk_id -&gt; (unit,'t)m;
  get_hd    : unit -&gt; ('blk_id,'t)m;
  get_tl    : unit -&gt; ('blk_id,'t)m;
  get_hd_tl : unit -&gt; ('blk_id * 'blk_id,'t)m;
  read_hd   : unit -&gt; ('a list * 'blk_id option,'t)m;
  append    : ('blk_id,'buf) plist -&gt; (unit,'t)m;
  (* read_tl   : unit -&gt; (('a list * 'blk_id option)or_error,'t)m; *)
  (* read_blk  : 'blk_id -&gt; (('a list * 'blk_id option)or_error,'t)m *)
}</code></pre></aside></details></div></div></div><dl><dt class="spec module" id="module-Plist_intf"><a href="#module-Plist_intf" class="anchor"></a><code><span class="keyword">module</span> <a href="Plist_intf/index.html">Plist_intf</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Plist main types</p></dd></dl><dl><dt class="spec module" id="module-Plist_sync_root_blk"><a href="#module-Plist_sync_root_blk" class="anchor"></a><code><span class="keyword">module</span> <a href="Plist_sync_root_blk/index.html">Plist_sync_root_blk</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Utility module, for adding sync when hd,tl ptrs change</p></dd></dl><dl><dt class="spec module" id="module-Make_1"><a href="#module-Make_1" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_1/index.html">Make_1</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Construct a persistent list (most generic version).</p></dd></dl><dl><dt class="spec module" id="module-Make_5"><a href="#module-Make_5" class="anchor"></a><code><span class="keyword">module</span> <a href="Make_5/index.html">Make_5</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Like <code>Make_1</code>, but outputs only a plist_factory; this is the preferred intf</p></dd></dl><dl><dt class="spec value" id="val-pl_examples"><a href="#val-pl_examples" class="anchor"></a><code><span class="keyword">val</span> pl_examples : &lt; int_plist_factory : <span>int <a href="Pl_type_abbrevs/index.html#type-plist_factory">Pl_type_abbrevs.plist_factory</a></span>; &gt;</code></dt></dl><aside><p>NOTE hidden doc for module <code>Pl_type_abbrevs</code></p></aside></div></body></html>