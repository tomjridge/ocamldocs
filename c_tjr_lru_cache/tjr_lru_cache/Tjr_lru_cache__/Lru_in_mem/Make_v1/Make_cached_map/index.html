<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make_cached_map (tjr_lru_cache.Tjr_lru_cache__.Lru_in_mem.Make_v1.Make_cached_map)</title><link rel="stylesheet" href="../../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../../index.html">tjr_lru_cache</a> &#x00BB; <a href="../../../index.html">Tjr_lru_cache__</a> &#x00BB; <a href="../../index.html">Lru_in_mem</a> &#x00BB; <a href="../index.html">Make_v1</a> &#x00BB; Make_cached_map</nav><h1>Module <code>Make_v1.Make_cached_map</code></h1><p>Construct the cached map, using existing map find operation.</p><p>NOTE the idea for <code>find</code> is that we execute a quick step to handle the case that there is an entry in the cache. If there isn't, we make a slow call to the lower layer, and when the result arrives we make another update to the cache state with the then current state of the cache. To avoid the risk of stale results being returned from lower, we have to tag lower results with some kind of monotonically-increasing index.</p></header><dl><dt class="spec value" id="val-get_evictees"><a href="#val-get_evictees" class="anchor"></a><code><span class="keyword">val</span> get_evictees : <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span><span>(<a href="../argument-1-S/index.html#type-k">S.k</a>, <a href="../argument-1-S/index.html#type-v">S.v</a>, <a href="../index.html#type-lru">lru</a>)</span> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-evictees_x_state">Tjr_lru_cache.Im_intf.evictees_x_state</a></span></code></dt><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : <a href="../argument-1-S/index.html#type-k">S.k</a> <span>&#45;&gt;</span> <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span>[&gt; <span>`In of <span><a href="../argument-1-S/index.html#type-v">S.v</a> option</span></span> <span>| `Not_in</span> ]</span></code></dt><dt class="spec value" id="val-perform"><a href="#val-perform" class="anchor"></a><code><span class="keyword">val</span> perform : <a href="../L/index.html#type-k">L.k</a> <span>&#45;&gt;</span> <a href="../L/index.html#type-v">L.v</a> <span>&#45;&gt;</span> <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span><span>(<a href="../argument-1-S/index.html#type-k">S.k</a>, <a href="../argument-1-S/index.html#type-v">S.v</a>, <a href="../index.html#type-lru">lru</a>)</span> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-evictees_x_state">Tjr_lru_cache.Im_intf.evictees_x_state</a></span></code></dt><dt class="spec value" id="val-insert"><a href="#val-insert" class="anchor"></a><code><span class="keyword">val</span> insert : <a href="../L/index.html#type-k">L.k</a> <span>&#45;&gt;</span> <a href="../argument-1-S/index.html#type-v">S.v</a> <span>&#45;&gt;</span> <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span><span>(<a href="../argument-1-S/index.html#type-k">S.k</a>, <a href="../argument-1-S/index.html#type-v">S.v</a>, <a href="../index.html#type-lru">lru</a>)</span> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-evictees_x_state">Tjr_lru_cache.Im_intf.evictees_x_state</a></span></code></dt><dt class="spec value" id="val-delete"><a href="#val-delete" class="anchor"></a><code><span class="keyword">val</span> delete : <a href="../L/index.html#type-k">L.k</a> <span>&#45;&gt;</span> <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span><span>(<a href="../argument-1-S/index.html#type-k">S.k</a>, <a href="../argument-1-S/index.html#type-v">S.v</a>, <a href="../index.html#type-lru">lru</a>)</span> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-evictees_x_state">Tjr_lru_cache.Im_intf.evictees_x_state</a></span></code></dt><dt class="spec value" id="val-update_from_lower"><a href="#val-update_from_lower" class="anchor"></a><code><span class="keyword">val</span> update_from_lower : <a href="../L/index.html#type-k">L.k</a> <span>&#45;&gt;</span> <span><a href="../argument-1-S/index.html#type-v">S.v</a> option</span> <span>&#45;&gt;</span> <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span><span>(<a href="../argument-1-S/index.html#type-k">S.k</a>, <a href="../argument-1-S/index.html#type-v">S.v</a>, <a href="../index.html#type-lru">lru</a>)</span> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-evictees_x_state">Tjr_lru_cache.Im_intf.evictees_x_state</a></span></code></dt><dt class="spec value" id="val-sync_key"><a href="#val-sync_key" class="anchor"></a><code><span class="keyword">val</span> sync_key : <a href="../argument-1-S/index.html#type-k">S.k</a> <span>&#45;&gt;</span> <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span><span>(<span><span>(<a href="../argument-1-S/index.html#type-k">S.k</a>, <a href="../argument-1-S/index.html#type-v">S.v</a>)</span> Tjr_fs_shared.kvop</span> * <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span>)</span> option</span></code></dt><dt class="spec value" id="val-sync_all_keys"><a href="#val-sync_all_keys" class="anchor"></a><code><span class="keyword">val</span> sync_all_keys : <span><a href="../index.html#type-lru">lru</a> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-lru_state_im">Tjr_lru_cache.Im_intf.lru_state_im</a></span> <span>&#45;&gt;</span> <span><span>(<a href="../L/index.html#type-k">L.k</a>, <a href="../argument-1-S/index.html#type-v">S.v</a>, <a href="../index.html#type-lru">lru</a>)</span> <a href="../../../../Tjr_lru_cache/Im_intf/index.html#type-evictees_x_state">Tjr_lru_cache.Im_intf.evictees_x_state</a></span></code></dt></dl></div></body></html>