<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tjr_lru_cache (tjr_lru_cache.Tjr_lru_cache)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">tjr_lru_cache</a> &#x00BB; Tjr_lru_cache</nav><h1>Module <code>Tjr_lru_cache</code></h1><p>A multithreaded LRU cache (part of ImpFS; safe to open)</p></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../Tjr_lru_cache__/index.html#module-Summary">Tjr_lru_cache__.Summary</a></code></span></summary><aside><p>Abbreviations:</p><ul><li>Im = In Memory</li><li>Lim = LRU (in memory)</li><li>mt = Multi-threaded</li></ul><p>Main types:</p><pre><code class="ml">type 'v entry = 
  | Insert of { value: 'v; dirty:bool }
  | Delete of { dirty:bool }
  | Lower of 'v option

type ('k,'v,'lru,'t) lru_factory = &lt;
  empty :       
    max_size    : int -&gt; 
    evict_count : int -&gt; 
    'lru;

  make_ops : 
    with_state : ('lru,'t) with_state -&gt;
    to_lower   : (('k,'v,'t) lru_msg -&gt; (unit,'t)m) -&gt; 
    ('k,'v,'t)mt_ops;

&gt;

type ('k,'v,'t) lru_msg = 
  | Insert of 'k*'v*(unit -&gt; (unit,'t)m)
  | Delete of 'k*(unit -&gt; (unit,'t)m)
  | Find of 'k * ('v option -&gt; (unit,'t)m)
  | Evictees of ('k * 'v entry) list

type ('k,'v,'t) mt_ops = {
  mt_find          : 'k -&gt; ('v option,'t) m; 
  mt_insert        : persist_mode -&gt; 'k -&gt; 'v -&gt; (unit,'t) m;
  mt_delete        : persist_mode -&gt; 'k -&gt; (unit,'t) m;
  mt_sync_key      : 'k -&gt; (unit,'t) m;
  mt_sync_all_keys : unit -&gt; (unit,'t) m;
}</code></pre><p>Examples in <a href="Lru_examples/index.html"><code>Lru_examples</code></a>.</p></aside></details></div></div></div><aside><p>NOTE hidden doc for private modules</p></aside><dl><dt class="spec module" id="module-Lru_entry"><a href="#module-Lru_entry" class="anchor"></a><code><span class="keyword">module</span> Lru_entry = <a href="Im_intf/index.html#module-Lru_entry">Im_intf.Lru_entry</a></code></dt><dd><p>NOTE module renamed from Entry</p></dd></dl><dl><dt class="spec type" id="type-lru_entry"><a href="#type-lru_entry" class="anchor"></a><code><span class="keyword">type</span> <span>'v lru_entry</span></code><code> = <span><span class="type-var">'v</span> <a href="../Tjr_lru_cache__Im_intf/Lru_entry/index.html#type-lru_entry">Lru_entry.lru_entry</a></span></code></dt></dl><dl><dt class="spec module" id="module-Mt_intf"><a href="#module-Mt_intf" class="anchor"></a><code><span class="keyword">module</span> <a href="Mt_intf/index.html">Mt_intf</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Main mt (multithreaded lru) types; don't open outside this lib</p></dd></dl><div class="spec module" id="module-Lru_msg"><a href="#module-Lru_msg" class="anchor"></a><code><span class="keyword">module</span> Lru_msg = <a href="Mt_intf/index.html#module-Lru_msg">Mt_intf.Lru_msg</a></code></div><dl><dt class="spec type" id="type-lru_msg"><a href="#type-lru_msg" class="anchor"></a><code><span class="keyword">type</span> <span>('k, 'v, 't) lru_msg</span></code><code> = <span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'t</span>)</span> <a href="../Tjr_lru_cache__Mt_intf/Lru_msg/index.html#type-lru_msg">Lru_msg.lru_msg</a></span></code></dt></dl><div class="spec module" id="module-Lru_factory"><a href="#module-Lru_factory" class="anchor"></a><code><span class="keyword">module</span> Lru_factory = <a href="Mt_intf/index.html#module-Lru_factory">Mt_intf.Lru_factory</a></code></div><dl><dt class="spec type" id="type-lru_factory"><a href="#type-lru_factory" class="anchor"></a><code><span class="keyword">type</span> <span>('k, 'v, 'lru, 't) lru_factory</span></code><code> = <span><span>(<span class="type-var">'k</span>, <span class="type-var">'v</span>, <span class="type-var">'lru</span>, <span class="type-var">'t</span>)</span> <a href="../Tjr_lru_cache__Mt_intf/Lru_factory/index.html#type-lru_factory">Lru_factory.lru_factory</a></span></code></dt></dl><div class="spec module" id="module-Mt_ops"><a href="#module-Mt_ops" class="anchor"></a><code><span class="keyword">module</span> Mt_ops = <a href="Mt_intf/index.html#module-Mt_ops">Mt_intf.Mt_ops</a></code></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="index.html#module-Mt_ops">Mt_ops</a></code></span></summary><aside><p>The main LRU operations, with a non-callback interface.</p></aside><aside><p>The main LRU operations, with a non-callback interface.</p></aside><dl><dt class="spec type" id="type-mt_ops"><a href="#type-mt_ops" class="anchor"></a><code><span class="keyword">type</span> <span>('k, 'v, 't) mt_ops</span></code><code> = </code><code>{</code><table class="record"><tr id="type-mt_ops.mt_find" class="anchored"><td class="def field"><a href="#type-mt_ops.mt_find" class="anchor"></a><code>mt_find : <span class="type-var">'k</span> <span>&#45;&gt;</span> <span><span>(<span><span class="type-var">'v</span> option</span>, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr><tr id="type-mt_ops.mt_insert" class="anchored"><td class="def field"><a href="#type-mt_ops.mt_insert" class="anchor"></a><code>mt_insert : <span class="type-var">'k</span> <span>&#45;&gt;</span> <span class="type-var">'v</span> <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr><tr id="type-mt_ops.mt_delete" class="anchored"><td class="def field"><a href="#type-mt_ops.mt_delete" class="anchor"></a><code>mt_delete : <span class="type-var">'k</span> <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr><tr id="type-mt_ops.mt_sync_key" class="anchored"><td class="def field"><a href="#type-mt_ops.mt_sync_key" class="anchor"></a><code>mt_sync_key : <span class="type-var">'k</span> <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr><tr id="type-mt_ops.mt_sync_all_keys" class="anchored"><td class="def field"><a href="#type-mt_ops.mt_sync_all_keys" class="anchor"></a><code>mt_sync_all_keys : unit <span>&#45;&gt;</span> <span><span>(unit, <span class="type-var">'t</span>)</span> Tjr_monad.m</span>;</code></td></tr></table><code>}</code></dt><dd><p>The interface provided by the multithreaded LRU; provides blocking/non-blocking operations, and persist now/persist later flags.</p><p>These are the operations supported by the LRU.</p><p>NOTE this interface doesn't allow &quot;transaction&quot; operations (multiple ops, which commit atomically). This is sufficient for ImpFS - the kv store is pointwise syncable not transactional. However, since the lower level does support transactional operations, it seems strange to limit the functionality here.</p><p>NOTE all calls are blocking; for non-blocking calls, launch an async light-weight thread.</p></dd></dl></details></div></div></div><dl><dt class="spec module" id="module-Multithreaded_lru"><a href="#module-Multithreaded_lru" class="anchor"></a><code><span class="keyword">module</span> <a href="Multithreaded_lru/index.html">Multithreaded_lru</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Non-functorial multithreaded / concurrent-safe implementation of the LRU interface. This extends the in-memory explicit-state-passing code to the monad.</p></dd></dl><div class="spec module" id="module-Lru_examples"><a href="#module-Lru_examples" class="anchor"></a><code><span class="keyword">module</span> Lru_examples = <a href="Multithreaded_lru/index.html#module-Examples">Multithreaded_lru.Examples</a></code></div></div></body></html>