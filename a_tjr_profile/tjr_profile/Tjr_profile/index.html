<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Tjr_profile (tjr_profile.Tjr_profile)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">tjr_profile</a> &#x00BB; Tjr_profile</nav><h1>Module <code>Tjr_profile</code></h1><p>Profiling is controlled via optcomp flags. The <code>Optcomp_config</code> module records those values as OCaml values.</p><p>Example (see Example module in Tjr_profile):</p><pre><code class="ml">let f () = 
  (* do something *)
  1+2

(** waypoint *)
let pt = intern &quot;pt&quot;

let profiler = make_profiler ()
let {mark;_} = profiler

let profiled_f () = 
  mark pt;
  let r = f () in
  mark (-1*pt);
  r

(** Run f 100 times, and print the profiling results at exit *)
let do_it () = 
  for i = 0 to 100 do
    ignore(profiled_f())
  done</code></pre><nav class="toc"><ul><li><a href="#configuation">Configuation</a></li><li><a href="#interface">Interface</a></li><li><a href="#profile-a-single-function">Profile a single function</a></li><li><a href="#example">Example</a></li></ul></nav></header><section><header><h3 id="configuation"><a href="#configuation" class="anchor"></a>Configuation</h3></header><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../Tjr_profile__/index.html#module-Optcomp_config">Tjr_profile__.Optcomp_config</a></code></span></summary><aside><p>The underlying timing method is controlled by optcomp <code>PROFILING_USE_TSC</code> variable.</p></aside><dl><dt class="spec value" id="val-profiling_use_tsc"><a href="#val-profiling_use_tsc" class="anchor"></a><code><span class="keyword">val</span> profiling_use_tsc : bool</code></dt><dd><p>We ARE using TSC for profiling.</p></dd></dl><dl><dt class="spec value" id="val-now"><a href="#val-now" class="anchor"></a><code><span class="keyword">val</span> now : unit <span>&#45;&gt;</span> int</code></dt><dt class="spec value" id="val-profiling_enabled"><a href="#val-profiling_enabled" class="anchor"></a><code><span class="keyword">val</span> profiling_enabled : bool</code></dt><dd><p>Profiling IS enabled (for profilers)</p></dd></dl></details></div></div></div></section><section><header><h3 id="interface"><a href="#interface" class="anchor"></a>Interface</h3></header><div class="spec module" id="module-Profile_intf"><a href="#module-Profile_intf" class="anchor"></a><code><span class="keyword">module</span> Profile_intf = <a href="../Tjr_profile__/index.html#module-Intf_">Tjr_profile__.Intf_</a></code></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="index.html#module-Profile_intf">Profile_intf</a></code></span></summary><aside></aside><aside><p>Profiling interfaces</p></aside><dl><dt class="spec type" id="type-profiler"><a href="#type-profiler" class="anchor"></a><code><span class="keyword">type</span> <span>'waypoint profiler</span></code><code> = </code><code>{</code><table class="record"><tr id="type-profiler.mark" class="anchored"><td class="def field"><a href="#type-profiler.mark" class="anchor"></a><code>mark : <span class="type-var">'waypoint</span> <span>&#45;&gt;</span> unit;</code></td></tr><tr id="type-profiler.get_marks" class="anchored"><td class="def field"><a href="#type-profiler.get_marks" class="anchor"></a><code>get_marks : unit <span>&#45;&gt;</span> <span><span>(<span class="type-var">'waypoint</span> * int)</span> list</span>;</code></td></tr><tr id="type-profiler.print_summary" class="anchored"><td class="def field"><a href="#type-profiler.print_summary" class="anchor"></a><code>print_summary : unit <span>&#45;&gt;</span> unit;</code></td></tr></table><code>}</code></dt><dd><p>Profiler ops:</p><ul><li>mark: imperative mark command</li><li>(pvt) get_marks: a list of all marked waypoints and the corresponding times at which they were marked</li><li>print_summary: print a human-readable summary (see <code>Pretty_print</code>)</li></ul></dd></dl><dl><dt class="spec value" id="val-dummy_profiler"><a href="#val-dummy_profiler" class="anchor"></a><code><span class="keyword">val</span> dummy_profiler : <span><span class="type-var">'a</span> <a href="index.html#type-profiler">profiler</a></span></code></dt></dl><dl><dt class="spec exception" id="exception-Profiling_exception"><a href="#exception-Profiling_exception" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Profiling_exception</span> <span class="keyword">of</span> string</code></dt></dl></details></div></div></div><dl><dt class="spec module" id="module-With_array"><a href="#module-With_array" class="anchor"></a><code><span class="keyword">module</span> <a href="With_array/index.html">With_array</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>This version attempts to reduce computation and GC costs during the profiling (there may be substantial processing costs at the end to compute the summary).</p></dd></dl><dl><dt class="spec value" id="val-make_profiler"><a href="#val-make_profiler" class="anchor"></a><code><span class="keyword">val</span> make_profiler : <span>?&#8288;print_header:string</span> <span>&#45;&gt;</span> <span>?&#8288;cap:int</span> <span>&#45;&gt;</span> <span>?&#8288;print_at_exit:bool</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span>int <a href="../Tjr_profile__/Intf_/index.html#type-profiler">Tjr_profile__.Intf_.profiler</a></span></code></dt><dd><p>By default, we use the array-based profiler</p></dd></dl><dl><dt class="spec value" id="val-intern"><a href="#val-intern" class="anchor"></a><code><span class="keyword">val</span> intern : string <span>&#45;&gt;</span> int</code></dt><dd><p>Waypoints are int (for efficiency); strings can be interned to convert them to ints; when interning a string &quot;foo&quot;, we also intern the string &quot;foo'&quot; as the negative of the intern of foo; this allows a common &quot;entry/exit&quot; idiom</p></dd></dl></section><section><header><h3 id="profile-a-single-function"><a href="#profile-a-single-function" class="anchor"></a>Profile a single function</h3></header><dl><dt class="spec module" id="module-Profile_single_function"><a href="#module-Profile_single_function" class="anchor"></a><code><span class="keyword">module</span> <a href="Profile_single_function/index.html">Profile_single_function</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Profile a single function which may be called many times, using &quot;enter&quot; and &quot;exit&quot;. This code keeps track of the number of times, and the total time.</p></dd></dl><dl><dt class="spec value" id="val-measure_execution_time_and_print"><a href="#val-measure_execution_time_and_print" class="anchor"></a><code><span class="keyword">val</span> measure_execution_time_and_print : string <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p>Measure execution time, and print result on output immediately. This is not affected by optcomp config.</p></dd></dl></section><section><header><h3 id="example"><a href="#example" class="anchor"></a>Example</h3></header><div class="spec module" id="module-Example"><a href="#module-Example" class="anchor"></a><code><span class="keyword">module</span> <a href="Example/index.html">Example</a> : <span class="keyword">functor</span> () <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>