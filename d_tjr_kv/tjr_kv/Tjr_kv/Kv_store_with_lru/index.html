<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Kv_store_with_lru (tjr_kv.Tjr_kv.Kv_store_with_lru)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">tjr_kv</a> &#x00BB; <a href="../index.html">Tjr_kv</a> &#x00BB; Kv_store_with_lru</nav><h1>Module <code>Tjr_kv.Kv_store_with_lru</code></h1><p>A KV store with an LRU cache frontend.</p><nav class="toc"><ul><li><a href="#architecture">Architecture</a><ul><li><a href="#queues:-q_lru_pc-and-q_pc_bt">Queues: q_lru_pc and q_pc_bt</a></li><li><a href="#blk-allocator">Blk allocator</a></li><li><a href="#lru">LRU</a></li><li><a href="#pcache">Pcache</a></li><li><a href="#b-tree">B-tree</a></li><li><a href="#root-manager">Root manager</a></li></ul></li></ul></nav></header><section><header><h3 id="architecture"><a href="#architecture" class="anchor"></a>Architecture</h3>

<img src="https://docs.google.com/drawings/d/e/2PACX-1vTIXhyNa7dovQYXuJXBMwPQZU99-x_tRdTIH3SkMUDyPwbL31zExWXauT2hO-eRIUcnGP3RVHiSHrjt/pub?w=557&amp;h=428">

<p>We construct the following...</p></header><section><header><h4 id="queues:-q_lru_pc-and-q_pc_bt"><a href="#queues:-q_lru_pc-and-q_pc_bt" class="anchor"></a>Queues: q_lru_pc and q_pc_bt</h4><ul><li>q_lru_pc, a msg queue from the lru to the pcache</li><li>q_pc_bt, a msg queue from the pcache to the B-tree</li></ul></header></section><section><header><h4 id="blk-allocator"><a href="#blk-allocator" class="anchor"></a>Blk allocator</h4><ul><li>provides blk alloc/free</li></ul></header></section><section><header><h4 id="lru"><a href="#lru" class="anchor"></a>LRU</h4><ul><li>lru_ops, concurrent-safe map operations</li></ul></header></section><section><header><h4 id="pcache"><a href="#pcache" class="anchor"></a>Pcache</h4><ul><li>pcache_thread, which takes msgs from q_pc_bt and executes against the pcache; also performs detach occasionally and enqueues messages to q_pc_bt</li></ul></header></section><section><header><h4 id="b-tree"><a href="#b-tree" class="anchor"></a>B-tree</h4><ul><li>btree_thread, listening to q_pc_bt and executing operations against the B-tree</li></ul></header></section><section><header><h4 id="root-manager"><a href="#root-manager" class="anchor"></a>Root manager</h4><ul><li>root_man, which is responsible for persisting the roots for the B-tree and the pcache</li></ul></header><dl><dt class="spec value" id="val-runtime_config"><a href="#val-runtime_config" class="anchor"></a><code><span class="keyword">val</span> runtime_config : <span><a href="../Kv_config_runtime/S/index.html#type-config">Kv_config_runtime.S.config</a> lazy_t</span></code></dt></dl><dl><dt class="spec type" id="type-params"><a href="#type-params" class="anchor"></a><code><span class="keyword">type</span> params</code><code> = &lt; lru_params : &lt; evict_count : int; max_size : int; &gt;; pcache_blocks_limit : int; &gt;</code></dt></dl><div class="spec module-type" id="module-type-S"><a href="#module-type-S" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-S/index.html">S</a> : <a href="index.html#module-type-S">S</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Examples"><a href="#module-Examples" class="anchor"></a><code><span class="keyword">module</span> <a href="Examples/index.html">Examples</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-Test"><a href="#module-Test" class="anchor"></a><code><span class="keyword">module</span> <a href="Test/index.html">Test</a> : <span class="keyword">functor</span> () <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></section></div></body></html>